# File Formats Reference

## .project/ Directory Structure

```
.project/
├── config.yaml          # Project configuration
├── PROJECT.md           # Architecture and design decisions
├── INFRASTRUCTURE.md    # Current infrastructure reality
├── SECURITY.md          # Security posture and review notes
├── DRIFT.md             # Auto-generated drift report
├── index.yaml           # Compact project dashboard
├── epics/
│   └── EPIC-PRJ-1.md   # Epic files
├── stories/
│   └── US-PRJ-1.md     # User story files
└── tasks/
    └── US-PRJ-1-1.md   # Task files
```

With `--hub`, also creates:
```
.project/
├── VISION.md            # Hub vision and mission
├── ARCHITECTURE.md      # System-wide architecture
├── DECISIONS.md         # Cross-project decision log
├── projects/
├── roadmap/
└── dashboards/
```

## config.yaml

Project configuration. Created by `projectman init`.

```yaml
name: my-project
prefix: PRJ              # Uppercase letters, used for epic/story/task IDs
description: ""
hub: false               # true for hub mode
next_story_id: 1         # Auto-incremented
next_epic_id: 1          # Auto-incremented
projects: []             # Hub mode: list of registered project names
```

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Project name |
| `prefix` | string | Uppercase letters, used as ID prefix for epics, stories, and tasks (e.g. `PRJ` → `EPIC-PRJ-1`, `US-PRJ-1`, `US-PRJ-1-1`) |
| `description` | string | Project description |
| `hub` | bool | Whether this is a hub (multi-repo) project |
| `next_story_id` | int | Next story number to assign (auto-incremented) |
| `next_epic_id` | int | Next epic number to assign (auto-incremented) |
| `projects` | list[str] | Hub mode: names of registered subprojects |

## index.yaml

Compact project dashboard. Auto-generated by write operations and audits.

```yaml
entries:
  - id: EPIC-PRJ-1
    title: Authentication system
    type: epic
    status: active
    points: 8
  - id: US-PRJ-1
    title: User authentication
    type: story
    status: active
    points: 5
    epic_id: EPIC-PRJ-1
  - id: US-PRJ-1-1
    title: JWT middleware
    type: task
    status: in-progress
    points: 2
    story_id: US-PRJ-1
total_points: 5
completed_points: 0
epic_count: 1
story_count: 1
task_count: 1
```

## Story Format (stories/US-PRJ-1.md)

Stories use YAML frontmatter followed by a markdown body.

```markdown
---
id: US-PRJ-1
title: User authentication
status: backlog
priority: should
points: 5
epic_id: EPIC-PRJ-1
tags: [auth, security]
created: '2026-02-15'
updated: '2026-02-15'
---

## As a user, I want to log in securely

So that my account is protected.

## Acceptance Criteria

- [ ] Login with email/password
- [ ] Password validation rules enforced
- [ ] Session management with timeout
```

### Story Frontmatter Fields

| Field | Type | Required | Values |
|-------|------|----------|--------|
| `id` | string | yes | Pattern: `US-PREFIX-N` (e.g. `US-PRJ-1`) |
| `title` | string | yes | Short descriptive title |
| `status` | enum | yes | `backlog`, `ready`, `active`, `done`, `archived` |
| `priority` | enum | yes | `must`, `should`, `could`, `wont` |
| `points` | int\|null | no | Fibonacci: 1, 2, 3, 5, 8, 13 |
| `epic_id` | string\|null | no | Parent epic ID |
| `tags` | list[str] | no | Free-form tags |
| `created` | date | yes | ISO date |
| `updated` | date | yes | ISO date |

### Story Status Lifecycle

```
backlog → ready → active → done → archived
```

## Task Format (tasks/US-PRJ-1-1.md)

Tasks use YAML frontmatter and serve as work orders for developers or Claude.

```markdown
---
id: US-PRJ-1-1
story_id: US-PRJ-1
title: Implement JWT middleware
status: todo
points: 2
assignee: null
created: '2026-02-15'
updated: '2026-02-15'
---

## Implementation

Add JWT validation middleware to the Express app.

### Files to modify
- `src/middleware/auth.ts`
- `src/config/jwt.ts`

## Testing

- Unit test JWT validation with valid/invalid/expired tokens
- Integration test protected endpoints

## Definition of Done

- [ ] Middleware validates JWT on protected routes
- [ ] Invalid tokens return 401
- [ ] Tests passing
```

### Task Frontmatter Fields

| Field | Type | Required | Values |
|-------|------|----------|--------|
| `id` | string | yes | Pattern: `US-PREFIX-N-N` (e.g. `US-PRJ-1-1`) |
| `story_id` | string | yes | Parent story ID |
| `title` | string | yes | Short descriptive title |
| `status` | enum | yes | `todo`, `in-progress`, `review`, `done`, `blocked` |
| `points` | int\|null | no | Fibonacci: 1, 2, 3, 5, 8, 13 |
| `assignee` | string\|null | no | Who is working on this |
| `created` | date | yes | ISO date |
| `updated` | date | yes | ISO date |

### Task Status Lifecycle

```
todo → in-progress → review → done
              ↓
           blocked
```

## Epic Format (epics/EPIC-PRJ-1.md)

Epics use YAML frontmatter followed by a markdown body.

```markdown
---
id: EPIC-PRJ-1
title: Authentication system
status: active
priority: must
points: 8
target_date: '2026-03-15'
tags: [auth, security]
created: '2026-02-15'
updated: '2026-02-15'
---

## Overview

Build a complete authentication system supporting email/password login,
session management, and role-based access control.

## Goals

- Secure user login and registration
- Session handling with configurable timeout
- Role-based authorization
```

### Epic Frontmatter Fields

| Field | Type | Required | Values |
|-------|------|----------|--------|
| `id` | string | yes | Pattern: `EPIC-PREFIX-N` (e.g. `EPIC-PRJ-1`) |
| `title` | string | yes | Short descriptive title |
| `status` | enum | yes | `draft`, `active`, `done`, `archived` |
| `priority` | enum | yes | `must`, `should`, `could`, `wont` |
| `points` | int\|null | no | Fibonacci: 1, 2, 3, 5, 8, 13 |
| `target_date` | date\|null | no | Target completion date |
| `tags` | list[str] | no | Free-form tags |
| `created` | date | yes | ISO date |
| `updated` | date | yes | ISO date |

### Epic Status Lifecycle

```
draft → active → done → archived
```

## DRIFT.md

Auto-generated by `pm_audit`. Lists inconsistencies found in the project.

```markdown
# Drift Report

Generated: 2026-02-15

## Findings: 2

### [ERROR] US-PRJ-1
Story marked done but has 1 incomplete task(s):
- US-PRJ-1-2: Add password hashing (todo)

### [INFO] US-PRJ-3
Story has no tasks — consider decomposing with /pm scope
```

Severity levels:
- **ERROR** — critical inconsistencies (done stories with incomplete tasks, done epics with open stories, missing documentation)
- **WARNING** — likely needs action (undecomposed stories, stale items, orphaned references, malformed files)
- **INFO** — suggestions (thin descriptions, point mismatches, stale drafts, stale documentation)

The audit runs 13 checks covering stories, tasks, epics, documentation, hub docs, assignments, and malformed files.
