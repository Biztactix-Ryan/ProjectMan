# File Formats Reference

## .project/ Directory Structure

```
.project/
├── config.yaml          # Project configuration
├── PROJECT.md           # Architecture and design decisions
├── INFRASTRUCTURE.md    # Current infrastructure reality
├── SECURITY.md          # Security posture and review notes
├── DRIFT.md             # Auto-generated drift report
├── index.yaml           # Compact project dashboard
├── stories/
│   └── PRJ-1.md         # User story files
└── tasks/
    └── PRJ-1-1.md       # Task files
```

## config.yaml

Project configuration. Created by `projectman init`.

```yaml
name: my-project
prefix: PRJ              # Uppercase letters, used for story IDs
description: ""
hub: false               # true for hub mode
next_story_id: 1         # Auto-incremented
projects: []             # Hub mode: list of registered project names
```

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Project name |
| `prefix` | string | Uppercase letters, used as ID prefix (e.g. `PRJ` → `PRJ-1`) |
| `description` | string | Project description |
| `hub` | bool | Whether this is a hub (multi-repo) project |
| `next_story_id` | int | Next story number to assign (auto-incremented) |
| `projects` | list[str] | Hub mode: names of registered subprojects |

## index.yaml

Compact project dashboard. Auto-generated by write operations and audits.

```yaml
entries:
  - id: PRJ-1
    title: User authentication
    type: story
    status: active
    points: 5
  - id: PRJ-1-1
    title: JWT middleware
    type: task
    status: in-progress
    points: 2
    story_id: PRJ-1
total_points: 5
completed_points: 0
story_count: 1
task_count: 1
```

## Story Format (stories/PRJ-1.md)

Stories use YAML frontmatter followed by a markdown body.

```markdown
---
id: PRJ-1
title: User authentication
status: backlog
priority: should
points: 5
tags: [auth, security]
created: '2026-02-15'
updated: '2026-02-15'
---

## As a user, I want to log in securely

So that my account is protected.

## Acceptance Criteria

- [ ] Login with email/password
- [ ] Password validation rules enforced
- [ ] Session management with timeout
```

### Story Frontmatter Fields

| Field | Type | Required | Values |
|-------|------|----------|--------|
| `id` | string | yes | Pattern: `PREFIX-N` (e.g. `PRJ-1`) |
| `title` | string | yes | Short descriptive title |
| `status` | enum | yes | `backlog`, `ready`, `active`, `done`, `archived` |
| `priority` | enum | yes | `must`, `should`, `could`, `wont` |
| `points` | int\|null | no | Fibonacci: 1, 2, 3, 5, 8, 13 |
| `tags` | list[str] | no | Free-form tags |
| `created` | date | yes | ISO date |
| `updated` | date | yes | ISO date |

### Story Status Lifecycle

```
backlog → ready → active → done → archived
```

## Task Format (tasks/PRJ-1-1.md)

Tasks use YAML frontmatter and serve as work orders for developers or Claude.

```markdown
---
id: PRJ-1-1
story_id: PRJ-1
title: Implement JWT middleware
status: todo
points: 2
assignee: null
created: '2026-02-15'
updated: '2026-02-15'
---

## Implementation

Add JWT validation middleware to the Express app.

### Files to modify
- `src/middleware/auth.ts`
- `src/config/jwt.ts`

## Testing

- Unit test JWT validation with valid/invalid/expired tokens
- Integration test protected endpoints

## Definition of Done

- [ ] Middleware validates JWT on protected routes
- [ ] Invalid tokens return 401
- [ ] Tests passing
```

### Task Frontmatter Fields

| Field | Type | Required | Values |
|-------|------|----------|--------|
| `id` | string | yes | Pattern: `PREFIX-N-N` (e.g. `PRJ-1-1`) |
| `story_id` | string | yes | Parent story ID |
| `title` | string | yes | Short descriptive title |
| `status` | enum | yes | `todo`, `in-progress`, `review`, `done`, `blocked` |
| `points` | int\|null | no | Fibonacci: 1, 2, 3, 5, 8, 13 |
| `assignee` | string\|null | no | Who is working on this |
| `created` | date | yes | ISO date |
| `updated` | date | yes | ISO date |

### Task Status Lifecycle

```
todo → in-progress → review → done
              ↓
           blocked
```

## DRIFT.md

Auto-generated by `pm_audit`. Lists inconsistencies found in the project.

```markdown
# Drift Report

Generated: 2026-02-15

## Findings: 2

### [WARNING] PRJ-1
Story marked done but has 1 incomplete task(s):
- PRJ-1-2: Add password hashing (todo)

### [INFO] PRJ-3
Story has no tasks — consider decomposing with /pm-scope
```

Severity levels:
- **WARNING** — likely needs action (done stories with open tasks, stale items)
- **INFO** — suggestions (undecomposed stories, thin descriptions, point mismatches)
